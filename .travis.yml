language: java
install: true
jdk:
  - openjdk8

env:
  global:
    - GPG_FILE_NAME="jcv_sign.gpg"
    - ENCRYPTED_GPG_FILE_NAME="jcv_sign.gpg.enc"
    - # GPG_KEY_ID
    - secure: "eV91qE2AUNcrTumNBV1xcIpZNXR+OPdLoK5b4DCkm3H/n6vd2n/XXIe2XjL1i/FNyWJADdaNr8GhcY0sRTkzjoOzlyZnuiDOcXqBMx9BNK2Q/4bfjzyhXrL1IncO48pwSE1i34hOPZilD6BpW4Fqry1Jt6L6NqRxbTz82shcN0caSqLVGXCIE4zeaxdAdMewz9Ow2q9786DgaVtWOZlDuq5zM8pOoDEeiHBp55XMRURXMbThUZzHeJcXR/RMlBh7JsU03W32PQuk9jQvJ6I5XWhc52PBSv33kbT456etk9HqfUxDX3gSnWvP0ji6Ofk+SnyvrUAGj/qOdoGmwg4Nsb0q7R7hPRbeCym5dlMrPLWlLGS0oNZADMtB1iXQPz38AGmNmxGK0w9KuQ8enU6w7efLAW+7Olfb4xn9pfgeUTMRQkyLYZxKGRxFFGpd6m+BkL/0MfpgBUmzjnjfE0PLiBsVjFd2uwDeEWzwcfXUHw2I5JNlv7RtHrGiwVgka5DgbjuQhj20yviAyOnYRpBGba+5kABjcaj4eRHWaQMZ0pPlpJswQK6WcTxfBMTMdtl7Hoqugis1zUhDN1Vw0l1UN6dTkTDZ0lFZGemTNki3OZquFwFbVoycevbmfzUvS8rFUt2moGC/QGe7ZJYGJgfqsIVIjvBW0F7sO5waVkUhyUw="
    - # GPG_PASSPHRASE
    - secure: "DLHGqC7+bH1nymLolkfi8qK/+1tJz8Aoj6vSWWD91LWYSo3LfyRNui3gsa9bp8/babVVvdiFqpjNt404Ad7fHJE48gO+lfuOkJNK1J6xuxHEnW6cdOBSAzY1vdzoRxuftucqzbO6s8ZS/oUU/uakSOtEbVeGu58H1Hhyq/MItSQ74lmbA0ievkVVWOQg8hN2rr37RXDco8Xqd1UGBlVywEDa2eRPlSXMpo7aUvhW+U6bbPbLiSQCb2tNu1o49YKVaSpWrjS2PfZ1KzLY1RxHiswS1Eri8ASaLPbaFhU7YMw/ScWAsh8B05a3C/LIOH5zXIH4sXBy+8NRMdX893lJLBd0FOCRzgzXBidKJHOGQnsONoCbjexxOOEtjGHNTBeS4E4l537YVDHtzMfDw3FrSr6OLbsSHqTCVS60SsPwp5m6/qEEMXuHPhpn/XnMHRuDMPuYpffyvKCU1Ugslus/82aCOM/CQWRtEg5m8hMxvWZk97nZEBKoqXCxX5aWSLLKaLp1P1Ddejq/SSUuqyNGpz2b4TSGPZ1Dz7SdQH9AzSgJsf/L5E3qc96/bUQ8rXB1cf9W/oBOmXmqkj8PfpDNKtmnerkfEi+hJIHBr/eSDaGnmk6ynNTqBxyAD2MzjAfUrLJpS0W2mSrXqp+Es4GoLciNnMC3V0IDZGh7u0i+Wu8="
    - # PUBLISH_REPO_USERNAME
    - secure: "ke0kTk0zvAePgBnG+178VTe+DQA8Mrt/d5WTmg1UDiBc7TrgWQ1gvNkMmKCQ5DtO+V/Iq0DE8HYHp5mMyNDnSzmFoK/Qe8fVXkghYzuEWWzhPwGIk0Y0C7Z6ykVKSqakymtk2Ns4sKl4ac4kdmrhxe2anHL56Ey4Xtl0Y+HUpvmw245g+5+ii3mXP0BayWtDRpBW901Yw/luPtNCOYrxT8OofX1jwT5iQAKwWccHsSevRhw0SsHmKFFwkgdmod0375HIG2+nVJFBDULGdkX4g6w3XBTIWNAQGzo50gMYSM56LtzI0znVoo7yFMA5IGdNO1Aixl75wUS2aB0abqnw3Z5Q7NkyROl61dtpnY9vsd9hRtOgnj8qBVpK8Q3MCFMQ+kG44PbJ6eWUJfc6xi8iRIYNbYAy4+WROi0RzT/UhSW3hx4eRGN0Rgq8gbe8h/u6QpEpHCwNTxegpdYjSY95r9lTKbEqSFJx8QT1jjl/LhA7RAt81l8vnrUZeV2HGzyReBLXQI9NnE+RTduTz44WnsoppZGjOxUI+aIWGHszw+OYA0PHQ4KwgVrs5JuLqHUI3Ze09NG74vhCzZGybsoBNnt+cuNJXJenmLMUju6XvPUvj+J6cG4G2W6tw8qT5ymIhhADyKY1Q3oDMpbFcDysnq7CgyI8VPiQh9qXGWq+1xA="
    - # PUBLISH_REPO_PASSWORD
    - secure: "kjrXHIkX5RaM93hVNg7AjYjvvNwXClJJhww0jkEwQKMxDVbVmm3krTLXlKgQcCNYChUnqeKxipH1Rq+RVs80Wp0+G5l4fq33kmuApdIKU1Yf1z082JcRnBG4Akc3gxLHTfxro5/SGNjcIyxw4Y8YjVeeC47Kt8A8eGNHbkqCKmh/8yv2aPumHfa20DRA1K1rfKeIr1GCVlOa58vUiMvDYuRJHAw7h7eHGib3OpaE2v7htXwdL2NA4pM5I7V/h79JY8veK4JNoJ0+vph4F/wYyCD7OZSshD2RbrB+DTmyvkUlZAIrrdkqUlrHCqlHSazfTtRUxEuUnCXpfiT2ztSMPkmgYoea8fYXtmcoyZnelqZYtk9NXmicLQNla0Shw8UkBrlPBBOBBUIvt9PxbaHFGgCMA1g0NVLJ0+/SU3u3PMYaznRckQiMTrdWD40LItcbUhtrVQ/nqRLsMVNNlKtNdSab7zK/alcyTOVWM27LcyFE6vCrhl2XORaGknnXr3WV/IUaEjOonVsrMzhNk7oBzTDyMgK+5ItAB60PxGDaU7p8x6ixQjaXi0R7MVIqWdKF3uWet1l2xt+kgIAgxBBUG9IlMafyj2FdMF0gbO3z4au+rLgyMH129Gx+OKd7hb9/gRVruBvJ3SYiz5KVXoCNUvpldcrd53NDo6lqMH9Ij/E="
    - # PUBLISH_SNAPSHOT_REPO_URL
    - secure: "UBxgelSTfZ4ubdsWx+WWq09Kwdics4qgWrDHUb39dEmteReWxO6NaNWuBSo/B02ycJxBvck8iUMJ70Tu6yhlN9Sf7KQHKtCu1dSAXPaOW2jhM7scdDp/ejQ+A3dWRCoImpdAQqlS/PSivSAHfqYHvoTrKom5cdLUYHxTFnQQ4IDFXJdP+1eUibcbiFjb5dDl8WafyXn1WIg+ooM3J49Y29GMzwZ8SCj7RxCd4hpWVb1gPnRQrbHWIaoGS6Y0G02LdMksDBDHzyuImcPd0FvaZ0VTZmrX6IhtZnCcU9Z3OcruERe+jhaFUGrG8iGz5p16nYav71HmDjlKrHw0pGa6HIef1fBwxqIxHKGBhLBvHDuKSqJJ2d4Gu61nZEfMieWJXbsCDqmnTGHaiibiC/W71RFF2Fg5OcJ0coNjcQ3I0J8tAqA+VhqSvxnU2lSaEZk3aLFnZ49CVfS6GhKAlfmSDhc21Tqm0d2sCFiRd1ra+jxZiamQw//qRUsWE9qFdw+TirokF40KuhyAC7TKVTR/TZf9Zul9BNxYQXu8/yfZJew9En2AwosLbBVQMx2RPyNVc478EfzJbyDJPxQpgJegBlBWDa0n74nUrHFGRopyk7jV3A9vtyn2VROmYPm2SlZxfBwWeAhEFMb11q+EfiaTbRjTOANxQz1D8nXcylhR9gw="
    - # PUBLISH_RELEASE_REPO_URL
    - secure: "iRGTsMuSM0y61WDxwJ4dj/NdpLK5SzVYK6kt+h1nOQPUFzlFebeKCDUkJ8W5416hSdIwgK2xqJYQMHJNR8r6ADN4qWk+QAWI3Y+4ZZZUmuFZjXjiPMST+v0aBB+snh24rCnYONuVhaoiUrplQgjQWsMyLI+mlVmNxoApStcb3ODGZTZarpqWwqrgwOhBHQ4PgDoMrSAuMBqlvrkty7gmnuHXp2pEGZZAvRnQWAYbRCINrSVxgFbQ3dm0EYgeUpoDQNLe6hxapzksmd3Ujf6o+v832ZfgWDDJabgX1f31Cgh97IFbQwhPWdUA65Ky1w5/d4yUB1JhWmJX5rjIBllMxqT/H8ikmFtRZ4aUv+voI4phuT5qKLm5mjQR9OrVMfTvKrLQbNU6Yh9ct77ZNxS2Fk+UmYyjptUjEsHFVPK7kVgxRiu14Pe0UYt8hNOuMJOqRb835RZSz823EFwQR+EFqfDNdAFPsQko32C6Aowyvs6SqU4V0/8LtwHauKYJ9SbXo0mkv4qshIC+MlqwNG0tkKt6hBou6yaqc+hTOdUMoEHH5wjgwo9Mnc1Octd3t6ofh3hVmhQEsSZFm2ovzPTGP921qmSvjS1Lb3kogkb7glq+siaG5ofxbtFk2hio2gq01JwDDpBMp9EgmYvlEDtWAO14B2BUhyRXDZoRmY2iZYU="

before_script:
  - chmod -R ug+x .travis

jobs:
  include:
    - stage: test
      name: Build
      script: .travis/build.sh
    - stage: deploy
      name: Deploy Snapshot
      if: |
        branch = master AND \
        type = push
      script: .travis/deploy.sh
    - stage: deploy
      name: Deploy Release
      if: tag IS present AND tag =~ ^(\d)+\.(\d)+(\.(\d)+)*(-[\w]+)*$
      script: .travis/deploy.sh
      deploy:
        provider: releases
        api_key:
          secure: kgOixqII+mq9WIbRDXQ7f4ZP3xNj38Sb4utN9jpbyVM+7IeKNHV3MjaEVrqTodbqSUR8wL43ux4HWTeOD5U5CqaTwHz4I9expJMjr6QDb/DVL80EwhGJoyiwkFwH5dbWJvz+16TPno63PIk2JFvbvaOzmbHAr8uTCLSHXxzjUVGLgGAelV1uVMG2kQbnQgjx5PT7BsLTdrXCLHoxftSRwG19kZ+ajuBXWAzt06abHo7xj7MSM3kYGwGspF3RwSuUk6uJrOLgBE+zhFGdKA/FpFViX4GmCODy1GY+lk4mzdXwldUJG1XG3U9uZa778a3qqjkIvOuc+ybsPxMIU0zCWIbc3hQCDTlZrzcRJmjd71OdrdxP4xCf3eYOFV8H1Sru7Na6NYhjgocjU7B8LEHyr03IDyI0R1vMWIYNOteIvxP/pQMKBLfbToSAaXbS2EEQ5ArbqRSMKaTX9LVTiIN+mTTVV8EzsDjI/OO1K/xHWS77kMAk9KxDQOubOGm1VQhS6gxE2fR1GUfUFRrgRKVVK/BZMyGKXLRl3846f+Msm3YjWyY2Z5ZmlmMjxb4PSO7a94CjjWwuKiW5nGo+O8In2WgZuadX8R0HiMIAV24BIrKwNisJ4zr/OSqtNjervF9pZ/KoYMNz/ptwWsLuChbGctUT8bATO1lk+x1jvdAbJs8=
        file_glob: true
        file:
          - "$TRAVIS_BUILD_DIR/jcv-core/build/libs/*"
          - "$TRAVIS_BUILD_DIR/jcv-assertj/build/libs/*"
          - "$TRAVIS_BUILD_DIR/jcv-hamcrest/build/libs/*"
        body: "Release of $TRAVIS_TAG"
        skip_cleanup: true
        draft: true
        on:
          repo: ekino/jcv
          tags: true

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - "$HOME/.gradle/caches/"
    - "$HOME/.gradle/wrapper/"
